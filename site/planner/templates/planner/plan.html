{% extends "base.html" %}
{% load staticfiles %}
{% load humanize %}
{% load core_tags %}
{% load i18n %}
{% block full_content %}
<div ng-controller="planController">
<div class="row" style="margin-top:20px;">
    <div class="col-md-9 project content-area">
        <h1 class="title">{{ plan.title }}</h1>
        {% if plan.description %}<p>{{ plan.description }}</p>{% endif %}

        <ol class="list-unstyled">
            {% for task in plan.tasks.all %}
            <li class="task-item">
                <div class="task-number">{{ forloop.index }}</div>

                <div class="task-title">
                    <a href="{% url 'planner:task' plan=plan.slug task=task.slug %}"><strong>{{ task.title }}</strong></a>
                </div>

                <small class="info">{{ task.subtype.name }} | {% trans "Status:" %} {{ task.status.name }}</small>
                <p>{{ task.text }}</p></li>
            {% endfor %}
        </ol>

        Add a new:
        <div class="btn-group">
            {% get_task_types as task_types %}
            {% for task in task_types %}
            <a href="{% url 'planner:task_create' slug=plan.slug type=task.slug %}" class="btn btn-default">{{ task.name }}</a>
            {% endfor %}
        </div>

    </div>
    <div class="col-md-3 sidebar-area">
        <ul class="list-group">
            {% for p in plans %}
            <li class="list-group-item{% if p.id == plan.id %} active{% endif %}"><a href="">{{ p.title }}</a></li>
            {% endfor %}
        </ul>

        <a href="{% url 'planner:new' %}" style="display:block;width:100%;text-align:center;">Create a new plan</a>
        <h5>People associated in this plan</h5>

        <button class="btn btn-primary" data-toggle="modal"
            data-target="#modalNew">Create</button>
    </div>
</div>

<div class="modal" id="editTask" tabindex="-1" role="dialog" aria-labelledby="modalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                    arial-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="modalLabel">{{ active_task.title }}</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="taskTitle">Task title</label>
                    <input type="text" class="form-control" id="taskTitle"
                        placeholder="Task title" value="{{ active_task.title }}">
                </div>
                <div class="form-group">
                    <label for="taskStatus">Task status</label>
                    <div class="btn-group">
                        <button class="btn btn-default">blaa</button>
                        <button class="btn btn-active">blaa</button>
                        <button class="btn btn-primary">blaa</button>
                        <button class="btn">blaa</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="taskType">Task type</label>
                    <input type="text" class="form-control" id="taskType"
                        placeholder="Task title" value="{{ active_task.type }}">
                </div>
                <div class="form-group">
                    <label for="taskBody">Task text</label>
                    <textarea class="form-control" id="taskBody"
                        placeholder="Task description here"
                        value="{{ active_task.body }}"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock full_content %}
{% block script %}
<script type="text/javascript" async="async">

siteApp.controller('planController', function($scope, APIService, $http) {
    $scope.plans = function() {
        return $http({method:'get', url:'api/plans/'});
    };

    $scope.plan = function(id) {
        return $http({method:'get', url:'api/plan/' + escape(id) + '/'});
    };

    $scope.active_project = null;
    $scope.activate_project = function(id) {
        $scope.plan(id).success(function(obj) {
            $scope.active_project = obj;
        });
    };

    $scope.activate_task = function(task) {
        $scope.active_task = task;
        console.log('active task changed');
        console.log(task);
    };

    $scope.plans().success(function(obj) {
        $scope.projects = obj.plans;
        $scope.activate_project($scope.projects[0].id);
    });

});

</script>
{% endblock %}
